{"componentChunkName":"component---src-templates-blog-post-js","path":"/db-datesearch/","result":{"data":{"site":{"siteMetadata":{"title":"Yong-log"}},"markdownRemark":{"id":"437b9e14-da7d-53d9-ac4d-1cb89faa1e4c","excerpt":"현재 진행하고 있는 프로젝트에서 나이를 통해 DB에 저장되어있는 회원들을 검색할 수 있는 기능을 구현했다.\n 1. 사용자 생일 저장하기 먼저 DB에 사용자의 생일은 저장해보자. MongoDB는 ISODate 형식을 저장하고 검색할 때 효율적인 쿼리 수행과 인덱싱을 지원한다. form…","html":"</br>\n<p>현재 진행하고 있는 프로젝트에서 나이를 통해 DB에 저장되어있는 회원들을 검색할 수 있는 기능을 구현했다.\n</br></p>\n</br>\n<h3>1. 사용자 생일 저장하기</h3>\n<p>먼저 DB에 사용자의 생일은 저장해보자.</p>\n<p>MongoDB는 ISODate 형식을 저장하고 검색할 때 효율적인 쿼리 수행과 인덱싱을 지원한다.</p>\n<p>form으로 날짜를 입력받고 ISO 8601형식으로 변환해서 저장해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">data<span class=\"token punctuation\">.</span>birth <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">editProfile</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>요러케 잘 저장이 되었다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 542px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e1c3bcf72621a5767130106a5e864f17/c0388/db-birth.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.59493670886076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdElEQVR42i2N6w6CUAyDef8nQ9BEBRM8hzviBRn2DUqT+WNp863rku+2sn0ZT40xjcbwMFaaMBvv0nIUD8Zz5z6rxbXLpY3uDtGnHIxHdSTrb2P/gcJgMYDjAlYz2InFp/ur+G2CisBLDxV5tn1Dj5zVf7YDFn+R+ZDCMUkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Drag\"\n        title=\"\"\n        src=\"/static/e1c3bcf72621a5767130106a5e864f17/c0388/db-birth.png\"\n        srcset=\"/static/e1c3bcf72621a5767130106a5e864f17/c26ae/db-birth.png 158w,\n/static/e1c3bcf72621a5767130106a5e864f17/6bdcf/db-birth.png 315w,\n/static/e1c3bcf72621a5767130106a5e864f17/c0388/db-birth.png 542w\"\n        sizes=\"(max-width: 542px) 100vw, 542px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</br>\n</br>\n<h3>2. 클라이언트에서 나이 조건으로 검색하기</h3>\n<p>이제 클라이언트에서 원하는 조건을 검색해보자.\nMUI의 slider를 사용해서 원하는 나이의 범위를 선택하고 쿼리를 만들어서 날려보자.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 352px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/804aa280c98f3cd3d39142e4ffa4021c/ba1c3/mui.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqUlEQVR42n2OvQrCQBCE7zF9DWvzJFEQ7ewEm1hZGCwFLWNAYmFjgooa7mf3xlxs9Dgz8DGwO8Ou0FrDRykFIsIwjhFFAyTJEk5SSoTy3wgEZK1tfZ2mGE+myA/Zz7xLonoa+FweBrVirLIXeqMj9meF/qzAYneFNNzuQz2H0AT4KNN801w7lRLzbYlbTdjkdxSVbL9w+1DPIcgY/IOpaYJh+ePMhK684w3wMn/NlJo38QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Drag\"\n        title=\"\"\n        src=\"/static/804aa280c98f3cd3d39142e4ffa4021c/ba1c3/mui.png\"\n        srcset=\"/static/804aa280c98f3cd3d39142e4ffa4021c/c26ae/mui.png 158w,\n/static/804aa280c98f3cd3d39142e4ffa4021c/6bdcf/mui.png 315w,\n/static/804aa280c98f3cd3d39142e4ffa4021c/ba1c3/mui.png 352w\"\n        sizes=\"(max-width: 352px) 100vw, 352px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>--클라이언트--</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>age<span class=\"token punctuation\">,</span> setAge<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> useState<span class=\"token operator\">&lt;</span>number<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">&lt;</span>Slider  \n    value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>age<span class=\"token punctuation\">}</span>  \n    onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleAgeChange<span class=\"token punctuation\">}</span>  \n    valueLabelDisplay<span class=\"token operator\">=</span><span class=\"token string\">\"auto\"</span>  \n    getAriaValueText<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>valuetext<span class=\"token punctuation\">}</span>  \n    disabled<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span>  \n<span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>여기에는 없지만, 다른 조건들도 함께 query string에 포함시켜야 하기 때문에 queryString변수에 나이 조건에 대한 query string 조건을 작성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">searchUser</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">filters</span><span class=\"token operator\">:</span>FilterProps</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>  \n     <span class=\"token keyword\">const</span> queryString <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>  \n        <span class=\"token operator\">...</span><span class=\"token punctuation\">(</span>filters<span class=\"token punctuation\">.</span>age <span class=\"token operator\">&amp;&amp;</span> filters<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">2</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> filters<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/user/searchUsers?</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>queryString<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">throw</span> error<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>3. 서버에서 나이 범위로 사용자 검색하기</h3>\n<p>서버에서는 클라이언트에서 나이의 범위를 각각 minAge, maxAge를 분해 구조 할당을 통해 받고</p>\n<p>각 나이의 출생일을 계산한다.</p>\n</br>\n<p>--서버--</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>minAge<span class=\"token punctuation\">,</span> maxAge<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> age<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>Number<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> today <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">const</span> maxBirth <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>today<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tmaxBirth<span class=\"token punctuation\">.</span><span class=\"token function\">setFullYear</span><span class=\"token punctuation\">(</span>today<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> minAge<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">const</span> minBirth <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>today<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tminBirth<span class=\"token punctuation\">.</span><span class=\"token function\">setFullYear</span><span class=\"token punctuation\">(</span>today<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> maxAge<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>today <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>maxBirth<span class=\"token punctuation\">.</span><span class=\"token function\">setFullYear</span><span class=\"token punctuation\">(</span>maxBirth<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\tmaxBirth<span class=\"token punctuation\">.</span><span class=\"token function\">setFullYear</span><span class=\"token punctuation\">(</span>maxBirth<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>today <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>minBirth<span class=\"token punctuation\">.</span><span class=\"token function\">setFullYear</span><span class=\"token punctuation\">(</span>minBirth<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\tminBirth<span class=\"token punctuation\">.</span><span class=\"token function\">setFullYear</span><span class=\"token punctuation\">(</span>minBirth<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\tquery<span class=\"token punctuation\">.</span>birth <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string-property property\">'$gte'</span><span class=\"token operator\">:</span> minBirth<span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">'$lt'</span><span class=\"token operator\">:</span> maxBirth<span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 조회를 해보면 95년생 라쿤이 잘 나온다...!</p>\n<!-- ![Resc](./res-console.png) -->\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4eb9bee4cc11f6f40097c3e692a09bdd/78363/res-screetshot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA80lEQVR42p2RsUoDQRRFpw42ktLCf0gRViw0RZBUQiKim8oQ4hJQvyF2kh9QwSofICjYiZVgK/6CpDAmLmSTzc683ZNZIdbuXjjMgxnOHXjKxDGRERYWI8Ik0PgzwzQUxnaOTIyW/yHWpYwxpKySXkRa0LYgPSV9mAE1X2i+xxM+h0O+RiPEyhPbtCLOiDo6drnodvl4e+Xqske93rBN8vvbJEnIGnXmeby/PHM/GHDT73N+2uHH9/MLnx4fuLu+ZW19g1Jpywo9pkGQX+i12zQPDikUN2ns1dh2HOZhmF/YOmlRLjtUa/vs7lRouu7f1vMIl9lfTWvJNaWwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Res\"\n        title=\"\"\n        src=\"/static/4eb9bee4cc11f6f40097c3e692a09bdd/f058b/res-screetshot.png\"\n        srcset=\"/static/4eb9bee4cc11f6f40097c3e692a09bdd/c26ae/res-screetshot.png 158w,\n/static/4eb9bee4cc11f6f40097c3e692a09bdd/6bdcf/res-screetshot.png 315w,\n/static/4eb9bee4cc11f6f40097c3e692a09bdd/f058b/res-screetshot.png 630w,\n/static/4eb9bee4cc11f6f40097c3e692a09bdd/40601/res-screetshot.png 945w,\n/static/4eb9bee4cc11f6f40097c3e692a09bdd/78612/res-screetshot.png 1260w,\n/static/4eb9bee4cc11f6f40097c3e692a09bdd/78363/res-screetshot.png 1522w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<br/>","frontmatter":{"title":"MongoDB 날짜 검색 (feat.React, express)","date":"May 20, 2024","description":"mongodb에서 생일이 특정 범위 내에 있는 유저들을 검색해보자."}},"previous":{"fields":{"slug":"/zoom and pan 2/"},"frontmatter":{"title":"JS 줌 앤 팬(Zoom and Pan) 구현하기(2)"}},"next":null},"pageContext":{"id":"437b9e14-da7d-53d9-ac4d-1cb89faa1e4c","previousPostId":"517732dd-55e8-5a7e-8c38-3042a26f3b3d","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}